<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í–‡ë‹˜ ë‹¬ë‹˜ ì´ì•¼ê¸° ì±—ë´‡</title>
    <!-- RDF ì²˜ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rdflib/2.2.11/rdflib.min.js"></script>
    <!-- ê·¸ë˜í”„ ì‹œê°í™” ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <!-- ê·€ì—¬ìš´ í°íŠ¸ (êµ¬ê¸€ í°íŠ¸: Jua) -->
    <link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@400;700&family=Jua&display=swap" rel="stylesheet">
    <style>
        :root {
            --main-bg: #E0F7FA;
            --chat-bg: #FFFFFF;
            --chat-border: #4DD0E1;
            --user-msg-bg: #FFEB3B;
            --bot-msg-bg: #E1F5FE;
            --accent-color: #FF9800;
        }

        body {
            font-family: 'Jua', sans-serif;
            background-color: var(--main-bg);
            /* ê·€ì—¬ìš´ êµ¬ë¦„ ë°°ê²½ íŒ¨í„´ íš¨ê³¼ */
            background-image:
                radial-gradient(circle at 20% 20%, white 0%, transparent 20%),
                radial-gradient(circle at 80% 80%, white 0%, transparent 20%);
            background-size: 300px 300px;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* ìƒë‹¨ í—¤ë” */
        header {
            background-color: #ffffff;
            padding: 15px 30px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            border-bottom: 5px solid var(--accent-color);
            z-index: 10;
        }

        h1 {
            color: var(--accent-color);
            margin: 0;
            font-size: 2.2rem;
            text-shadow: 2px 2px 0px #FFF3E0;
        }

        .subtitle {
            font-family: 'Gaegu', cursive;
            font-size: 1.2rem;
            color: #555;
            margin-top: 5px;
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .container {
            display: flex;
            flex: 1;
            height: calc(100vh - 100px);
            padding: 20px;
            gap: 20px;
        }

        /* ì™¼ìª½ íŒ¨ë„: ì±—ë´‡ */
        .chat-panel {
            flex: 1;
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 3px solid var(--chat-border);
            max-width: 400px;
        }

        .chat-header {
            background-color: var(--chat-border);
            color: white;
            padding: 15px;
            font-size: 1.3rem;
            text-align: center;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background-color: #FAFAFA;
        }

        .message {
            max-width: 80%;
            padding: 12px 18px;
            border-radius: 20px;
            font-size: 1.1rem;
            line-height: 1.4;
            position: relative;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .message.bot {
            align-self: flex-start;
            background-color: var(--bot-msg-bg);
            border-bottom-left-radius: 5px;
            border: 2px solid #B3E5FC;
        }

        .message.user {
            align-self: flex-end;
            background-color: var(--user-msg-bg);
            border-bottom-right-radius: 5px;
            border: 2px solid #FDD835;
        }

        .input-area {
            padding: 15px;
            background-color: #fff;
            border-top: 2px solid #eee;
            display: flex;
            gap: 10px;
        }

        input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 15px;
            font-family: 'Jua', sans-serif;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s;
        }

        input:focus {
            border-color: var(--accent-color);
        }

        button {
            padding: 10px 20px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 15px;
            font-family: 'Jua', sans-serif;
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        button:hover {
            transform: translateY(-2px);
        }

        /* ì˜¤ë¥¸ìª½ íŒ¨ë„: RDF ê·¸ë˜í”„ */
        .graph-panel {
            flex: 2;
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            border: 3px solid #AED581;
            /* ì—°ë‘ìƒ‰ í…Œë‘ë¦¬ */
        }

        .graph-header {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 5;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 15px;
            border: 2px solid #AED581;
            font-size: 1.2rem;
            color: #558B2F;
        }

        #mynetwork {
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #f1f8e9, #ffffff);
        }

        /* ë¡œë”©/ì—ëŸ¬ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        .system-msg {
            text-align: center;
            color: #888;
            font-size: 0.9rem;
            margin: 10px 0;
            font-family: 'Gaegu', cursive;
        }
    </style>
</head>

<body>

    <header>
        <h1>ğŸŒ í–‡ë‹˜ ë‹¬ë‹˜ ì´ì•¼ê¸° ê·¸ë˜í”„ ğŸŒ›</h1>
        <div class="subtitle">ì¹œì ˆí•œ ë¶€ì—‰ì´ ì±—ë´‡ê³¼ í•¨ê»˜ ì´ì•¼ê¸°ë¥¼ ì•Œì•„ë´ìš”!</div>
    </header>

    <div class="container">
        <!-- ì±—ë´‡ ì˜ì—­ -->
        <div class="chat-panel">
            <div class="chat-header">
                ğŸ¦‰ ì´ì•¼ê¸° ì²™ì²™ë°•ì‚¬ ë¶€ì—‰ì´
            </div>
            <div class="chat-messages" id="messages">
                <div class="message bot">ì•ˆë…•! ë‚˜ëŠ” ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ì£¼ëŠ” ë¶€ì—‰ì´ì•¼. <br>ì˜¤ë¥¸ìª½ ê·¸ë¦¼ì„ ëˆ„ë¥´ê±°ë‚˜ ê¶ê¸ˆí•œ ê±¸ ë¬¼ì–´ë´! ğŸ¦‰</div>
            </div>
            <div class="input-area">
                <input type="text" id="userInput" placeholder="ê¶ê¸ˆí•œ ê±¸ ë¬¼ì–´ë³´ì„¸ìš”..."
                    onkeypress="if(event.key==='Enter') sendMessage()">
                <button onclick="sendMessage()">ë³´ë‚´ê¸° ğŸš€</button>
            </div>
        </div>

        <!-- ê·¸ë˜í”„ ì˜ì—­ -->
        <div class="graph-panel">
            <div class="graph-header">âœ¨ ë°˜ì§ë°˜ì§ ì§€ì‹ ì§€ë„</div>
            <div id="mynetwork"></div>
        </div>
    </div>

    <script>
        // 1. RDF ë°ì´í„° ì •ì˜ (Turtle í˜•ì‹)
        // ì´ˆë“±í•™ìƒ ëˆˆë†’ì´ì— ë§ì¶˜ ì¹œê·¼í•œ ì„¤ëª…ìœ¼ë¡œ êµ¬ì„±
        const turtleData = `
@prefix ex: <http://example.org/folktale/> .
@prefix schema: <https://schema.org/> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .

# ì£¼ì¸ê³µë“¤
ex:Mother
    schema:name "ì–´ë¨¸ë‹ˆ" ;
    ex:type "ì£¼ì¸ê³µ" ;
    ex:desc "ë§›ìˆëŠ” ë–¡ì„ íŒ”ì•„ì„œ ì˜¤ëˆ„ì´ë¥¼ ëŒë³´ëŠ” ë”°ëœ»í•œ ë¶„ì´ì•¼." .

ex:Brother
    schema:name "ì˜¤ë¹ " ;
    ex:type "ì£¼ì¸ê³µ" ;
    ex:becomes "ë‹¬ë‹˜" ;
    ex:desc "ìš©ê°í•˜ê³  ë™ìƒì„ ì˜ ì±™ê¸°ëŠ” ì˜¤ë¹ ì•¼. ë‚˜ì¤‘ì— ë°¤ì„ ë¹„ì¶”ëŠ” ë‹¬ë‹˜ì´ ë˜ì—ˆì–´." .

ex:Sister
    schema:name "ì—¬ë™ìƒ" ;
    ex:type "ì£¼ì¸ê³µ" ;
    ex:becomes "í–‡ë‹˜" ;
    ex:desc "í˜¸ê¸°ì‹¬ ë§ê³  ê·€ì—¬ìš´ ì—¬ë™ìƒì´ì•¼. ë‚˜ì¤‘ì— ì„¸ìƒì„ ë°íˆëŠ” í–‡ë‹˜ì´ ë˜ì—ˆì–´." .

# ì•…ë‹¹
ex:Tiger
    schema:name "í˜¸ë‘ì´" ;
    ex:type "ì•…ë‹¹" ;
    ex:behavior "ì–´í¥! ë–¡ í•˜ë‚˜ ì£¼ë©´ ì•ˆ ì¡ì•„ë¨¹ì§€!" ;
    ex:desc "ì–´ë¨¸ë‹ˆì™€ ì˜¤ëˆ„ì´ë¥¼ ê´´ë¡­íˆëŠ” ë¬´ì„œìš´ í˜¸ë‘ì´ì•¼. ê²°êµ­ ë²Œì„ ë°›ê²Œ ë¼." .

# ì´ì•¼ê¸° ì†Œí’ˆê³¼ ì¥ì†Œ
ex:Rope
    schema:name "ë™ì•„ì¤„" ;
    ex:type "ë„êµ¬" ;
    ex:desc "í•˜ëŠ˜ì—ì„œ ë‚´ë ¤ì˜¨ íŠ¼íŠ¼í•œ ì¤„! ì˜¤ëˆ„ì´ë¥¼ í•˜ëŠ˜ë‚˜ë¼ë¡œ ë°ë ¤ë‹¤ì£¼ì—ˆì–´." .

ex:Tree
    schema:name "í° ë‚˜ë¬´" ;
    ex:type "ì¥ì†Œ" ;
    ex:desc "ì˜¤ëˆ„ì´ê°€ í˜¸ë‘ì´ë¥¼ í”¼í•´ ë„ë§ì¹œ ì•„ì£¼ ë†’ì€ ë‚˜ë¬´ì•¼." .

ex:Sun
    schema:name "í–‡ë‹˜" ;
    ex:type "í•˜ëŠ˜" .

ex:Moon
    schema:name "ë‹¬ë‹˜" ;
    ex:type "í•˜ëŠ˜" .

# ê´€ê³„ (ëˆ„ê°€ ëˆ„êµ¬ë¥¼, ë¬´ì—‡ì„ ì–´ë–»ê²Œ í–ˆë‚˜)
ex:Mother ex:loves ex:Brother, ex:Sister .
ex:Tiger ex:chases ex:Brother, ex:Sister .
ex:Brother ex:escapesTo ex:Tree .
ex:Sister ex:escapesTo ex:Tree .
ex:Brother ex:becomes ex:Moon .
ex:Sister ex:becomes ex:Sun .
`;

        // 2. ì´ˆê¸°í™” ë° ì„¤ì •
        const store = $rdf.graph();
        const baseUrl = "http://example.org/";
        const contentType = 'text/turtle';
        let network;

        // ì´ëª¨ì§€ ë§¤í•‘ (ë…¸ë“œë¥¼ ê·€ì—½ê²Œ!)
        const emojiMap = {
            "ì–´ë¨¸ë‹ˆ": "ğŸ‘©â€ğŸ³",
            "ì˜¤ë¹ ": "ğŸ‘¦",
            "ì—¬ë™ìƒ": "ğŸ‘§",
            "í˜¸ë‘ì´": "ğŸ¯",
            "í–‡ë‹˜": "â˜€ï¸",
            "ë‹¬ë‹˜": "ğŸŒ™",
            "ë™ì•„ì¤„": "â°",
            "í° ë‚˜ë¬´": "ğŸŒ³",
            "ë„êµ¬": "ğŸ”¨",
            "ì¥ì†Œ": "ğŸ ",
            "ì•…ë‹¹": "ğŸ‘¿"
        };

        // 3. ì‹¤í–‰ ë¡œì§
        window.onload = function () {
            try {
                // RDF íŒŒì‹±
                $rdf.parse(turtleData, store, baseUrl, contentType);
                console.log("RDF ë°ì´í„° íŒŒì‹± ì™„ë£Œ!");
                drawGraph();
            } catch (e) {
                console.error("ì˜¤ë¥˜ ë°œìƒ:", e);
                addMessage('bot', "ì•—! ë°ì´í„°ë¥¼ ì½ë‹¤ê°€ ë¬¸ì œê°€ ìƒê²¼ì–´ìš”. ğŸ˜µ");
            }
        };

        // 4. ê·¸ë˜í”„ ê·¸ë¦¬ê¸° (Vis.js)
        function drawGraph() {
            const nodes = new vis.DataSet();
            const edges = new vis.DataSet();
            const nodeIds = new Set();

            store.statements.forEach(st => {
                const subj = st.subject;
                const pred = st.predicate;
                const obj = st.object;

                // ë…¸ë“œ ì´ë¦„ ì¶”ì¶œ í•¨ìˆ˜
                const getName = (term) => {
                    // ë¦¬í„°ëŸ´(ë¬¸ìì—´)ì´ë©´ ê°’ ê·¸ëŒ€ë¡œ
                    if (term.termType === 'Literal') return term.value;

                    // URIë©´ ë¯¸ë¦¬ ì •ì˜ëœ schema:nameì„ ì°¾ê±°ë‚˜ URI ë’·ë¶€ë¶„ ì‚¬ìš©
                    if (term.termType === 'NamedNode') {
                        const nameNode = store.any(term, $rdf.sym("https://schema.org/name"));
                        if (nameNode) return nameNode.value;
                        return term.value.split(/[/#]/).pop();
                    }
                    return term.value;
                };

                const sName = getName(subj);
                const oName = getName(obj);

                // ìˆ ì–´(ê´€ê³„) ì´ë¦„ ì •ì œ
                let pName = pred.value.split(/[/#]/).pop();
                // ë³´ê¸° ì¢‹ê²Œ í•œê¸€ë¡œ ë³€í™˜ (ì¼ë¶€ë§Œ)
                if (pName === 'loves') pName = 'ì‚¬ë‘í•´ìš”';
                if (pName === 'chases') pName = 'ì«“ì•„ê°€ìš”';
                if (pName === 'escapesTo') pName = 'ë„ë§ì³ìš”';
                if (pName === 'becomes') pName = 'ë³€ì‹ !';
                if (pName === 'type') pName = 'ì¢…ë¥˜';
                if (pName === 'desc') pName = 'ì„¤ëª…';
                if (pName === 'behavior') pName = 'í–‰ë™';

                // ë„ˆë¬´ ê¸´ í…ìŠ¤íŠ¸(ì„¤ëª… ë“±)ëŠ” ê·¸ë˜í”„ì—ì„œ ì œì™¸í•˜ê±°ë‚˜ ê°„ëµíˆ
                if (pName === 'ì„¤ëª…') return; // ì„¤ëª…ì€ ì±—ë´‡ì—ì„œë§Œ ë³´ì—¬ì£¼ì (ê·¸ë˜í”„ ë³µì¡ë„ ì¤„ì´ê¸°)

                // ë…¸ë“œ ì¶”ê°€ (Subject)
                if (!nodeIds.has(sName)) {
                    nodes.add({
                        id: sName,
                        label: sName + "\n" + (emojiMap[sName] || "âœ¨"),
                        shape: 'box',
                        font: { face: 'Jua', size: 20, color: '#333' },
                        color: { background: '#FFF9C4', border: '#FBC02D' },
                        margin: 10
                    });
                    nodeIds.add(sName);
                }

                // ë…¸ë“œ ì¶”ê°€ (Object) - ë¦¬í„°ëŸ´ì´ ë„ˆë¬´ ê¸¸ë©´ ì œì™¸
                if (obj.value.length < 20) {
                    if (!nodeIds.has(oName)) {
                        let color = { background: '#E1F5FE', border: '#039BE5' };
                        // ê°ì²´ íƒ€ì…ì— ë”°ë¼ ìƒ‰ìƒ ì¡°ê¸ˆ ë‹¤ë¥´ê²Œ
                        if (emojiMap[oName]) color = { background: '#FFF', border: '#333' };

                        nodes.add({
                            id: oName,
                            label: oName + (emojiMap[oName] ? "\n" + emojiMap[oName] : ""),
                            shape: 'ellipse',
                            font: { face: 'Gaegu', size: 16 },
                            color: color
                        });
                        nodeIds.add(oName);
                    }

                    // ì—£ì§€ ì¶”ê°€
                    edges.add({
                        from: sName,
                        to: oName,
                        label: pName,
                        arrows: 'to',
                        font: { align: 'middle', face: 'Gaegu', size: 14, color: '#555' },
                        color: { color: '#FFB74D' },
                        dashes: true
                    });
                }
            });

            const container = document.getElementById('mynetwork');
            const data = { nodes: nodes, edges: edges };
            const options = {
                physics: {
                    enabled: true,
                    barnesHut: {
                        gravitationalConstant: -2000,
                        centralGravity: 0.3,
                        springLength: 95,
                        springConstant: 0.04,
                        damping: 0.09,
                        avoidOverlap: 0.1
                    },
                },
                interaction: {
                    hover: true,
                    tooltipDelay: 200
                }
            };

            network = new vis.Network(container, data, options);

            // ì¤‘ìš”: ë…¸ë“œ í´ë¦­ ì´ë²¤íŠ¸!
            network.on("click", function (params) {
                if (params.nodes.length > 0) {
                    const clickNode = params.nodes[0];
                    askAboutNode(clickNode);
                }
            });
        }

        // 5. ì±—ë´‡ ê¸°ëŠ¥
        function sendMessage() {
            const input = document.getElementById('userInput');
            const text = input.value.trim();
            if (!text) return;

            addMessage('user', text);
            input.value = '';

            // ìƒê°í•˜ëŠ” ì²™ ë”œë ˆì´
            setTimeout(() => {
                respondTo(text);
            }, 500);
        }

        function askAboutNode(nodeName) {
            // "ì–´ë¨¸ë‹ˆ" í´ë¦­ ì‹œ -> "ì–´ë¨¸ë‹ˆì— ëŒ€í•´ ì•Œë ¤ì¤˜"
            addMessage('user', nodeName + "(ì´)ê°€ ë­ì•¼?");
            setTimeout(() => {
                respondTo(nodeName);
            }, 500);
        }

        function addMessage(type, text) {
            const container = document.getElementById('messages');
            const div = document.createElement('div');
            div.className = `message ${type}`;
            div.innerHTML = text;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        // ê°„ë‹¨í•œ ì¶”ë¡  ì—”ì§„
        function respondTo(query) {
            let found = false;
            let response = "";
            const q = query.toLowerCase();

            // 1. RDF ë°ì´í„°ì—ì„œ description(ì„¤ëª…) ì°¾ê¸°
            store.statements.forEach(st => {
                // ì£¼ì–´ì˜ ì´ë¦„ì„ í™•ì¸
                let subjName = st.subject.value.split(/[/#]/).pop();
                const nameNode = store.any(st.subject, $rdf.sym("https://schema.org/name"));
                if (nameNode) subjName = nameNode.value;

                // ì§ˆë¬¸ì— ì£¼ì–´ ì´ë¦„ì´ í¬í•¨ë˜ë©´ ì„¤ëª… ì°¾ê¸°
                if (q.includes(subjName) || q.includes(subjName.replace(' ', ''))) {
                    // ì„¤ëª…(desc) ìˆ ì–´ ì°¾ê¸°
                    const desc = store.any(st.subject, $rdf.sym("http://example.org/folktale/desc"));
                    if (desc) {
                        response = `<b>${subjName}</b>: ${desc.value}`;
                        found = true;
                    }
                }
            });

            if (!found) {
                if (q.includes("ì•ˆë…•")) {
                    response = "ì•ˆë…•! ë°˜ê°€ì›Œ. ìš°ë¦¬ ê°™ì´ ì˜›ë‚  ì´ì•¼ê¸° ì—¬í–‰ì„ ë– ë‚˜ë³¼ê¹Œ? ğŸˆ";
                } else if (q.includes("êµí›ˆ") || q.includes("ë°°ìš´")) {
                    response = "ì´ ì´ì•¼ê¸°ì˜ êµí›ˆì€ 'ì–´ë ¤ìš´ ìƒí™©ì—ì„œë„ ì¹¨ì°©í•˜ê²Œ ì§€í˜œë¥¼ ë°œíœ˜í•˜ë©´ ë²—ì–´ë‚  ìˆ˜ ìˆë‹¤'ëŠ” ê±°ì•¼! ğŸ’¡";
                } else if (q.includes("ëˆ„ê°€") || q.includes("ë“±ì¥")) {
                    response = "ì–´ë¨¸ë‹ˆ, ì˜¤ëˆ„ì´(ì˜¤ë¹ ì™€ ì—¬ë™ìƒ), ê·¸ë¦¬ê³  ë¬´ì„œìš´ í˜¸ë‘ì´ê°€ ë‚˜ì™€! ğŸ¯";
                } else {
                    response = "ìŒ.. ê·¸ê±´ ì•„ì§ ë‚´ ë¹„ë°€ ë…¸íŠ¸ì— ì—†ëŠ” ë‚´ìš©ì´ì•¼. ğŸ¤” <br>ì˜¤ë¥¸ìª½ ê·¸ë¦¼ì— ìˆëŠ” ì¹œêµ¬ë“¤ì„ í´ë¦­í•´ë³¼ë˜?";
                }
            } else {
                // ì¶”ê°€ ë©˜íŠ¸
                response += " <br>ë˜ ê¶ê¸ˆí•œ ê±° ìˆì–´? ğŸ‘€";
            }

            addMessage('bot', response);
        }

    </script>
</body>

</html>