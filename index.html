<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í–‡ë‹˜ ë‹¬ë‹˜ ì§€ì‹ ì±—ë´‡ - ì´ë¯¸ì§€ ê·¸ë˜í”„</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rdflib/2.2.11/rdflib.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; line-height: 1.6; display: flex; flex-direction: column; align-items: center; }
        #chatbot-container { display: flex; width: 90%; max-width: 1200px; margin-top: 20px; }
        #visualization-area { flex: 1; border: 1px solid #ddd; margin-right: 20px; display: flex; justify-content: center; align-items: center; background: linear-gradient(to bottom, #87CEEB, #ffffff); position: relative; min-height: 400px; overflow: hidden; }
        #chat-area { flex: 1; display: flex; flex-direction: column; }
        #chat-window { border: 1px solid #ccc; height: 300px; overflow-y: scroll; padding: 10px; margin-bottom: 10px; background: #f9f9f9; flex-grow: 1; }
        .bot { color: blue; margin-bottom: 5px; }
        .user { color: green; margin-bottom: 5px; text-align: right; }
        #input-area { display: flex; }
        input { flex-grow: 1; padding: 10px; border: 1px solid #ccc; }
        button { padding: 10px 15px; background-color: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #0056b3; }

        /* SVG ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
        .story-element { position: absolute; cursor: pointer; transition: transform 0.3s ease; }
        .story-element:hover { transform: scale(1.1); }

        /* í•´ ì•„ì´ì½˜ */
        #sun { width: 80px; height: 80px; top: 10%; right: 15%; }
        #sun circle { fill: gold; }
        #sun line { stroke: orange; stroke-width: 3; }

        /* ë‹¬ ì•„ì´ì½˜ */
        #moon { width: 70px; height: 70px; top: 15%; left: 15%; }
        #moon circle { fill: silver; }

        /* ë‚˜ë¬´ ì•„ì´ì½˜ */
        #tree { width: 100px; height: 150px; bottom: 0; left: 50%; transform: translateX(-50%); }
        #tree rect { fill: #8B4513; } /* ë‚˜ë¬´ ê¸°ë‘¥ */
        #tree circle { fill: forestgreen; } /* ë‚˜ë­‡ì */

        /* ì§‘ ì•„ì´ì½˜ */
        #house { width: 100px; height: 100px; bottom: 50px; left: 20%; }
        #house rect { fill: #A0522D; } /* ë²½ */
        #house polygon { fill: #8B0000; } /* ì§€ë¶• */
    </style>
</head>
<body>

    <h2>ğŸŒ í–‡ë‹˜ ë‹¬ë‹˜ ì§€ì‹ ì±—ë´‡</h2>

    <div id="chatbot-container">
        <div id="visualization-area">
            <svg id="sun" class="story-element" viewBox="0 0 100 100" onclick="askChatbotWithKeyword('í•´ì™€ ë‹¬')">
                <circle cx="50" cy="50" r="40" />
                <line x1="50" y1="0" x2="50" y2="15" />
                <line x1="15" y1="15" x2="0" y2="0" />
                <line x1="0" y1="50" x2="15" y2="50" />
                <line x1="15" y1="85" x2="0" y2="100" />
                <line x1="50" y1="85" x2="50" y2="100" />
                <line x1="85" y1="85" x2="100" y2="100" />
                <line x1="85" y1="50" x2="100" y2="50" />
                <line x1="85" y1="15" x2="100" y2="0" />
            </svg>

            <svg id="moon" class="story-element" viewBox="0 0 100 100" onclick="askChatbotWithKeyword('í•´ì™€ ë‹¬')">
                <circle cx="50" cy="50" r="40" />
                <circle cx="65" cy="40" r="35" fill="#f9f9f9" />
            </svg>
            
            <svg id="tree" class="story-element" viewBox="0 0 100 150" onclick="askChatbotWithKeyword('ë‚˜ë¬´')">
                <rect x="40" y="50" width="20" height="100" />
                <circle cx="50" cy="50" r="40" />
                <circle cx="30" cy="30" r="30" />
                <circle cx="70" cy="30" r="30" />
            </svg>

            <svg id="house" class="story-element" viewBox="0 0 100 100" onclick="askChatbotWithKeyword('ë°°ê²½')">
                <rect x="10" y="40" width="80" height="50" />
                <polygon points="50,10 10,40 90,40" />
            </svg>
        </div>

        <div id="chat-area">
            <div id="chat-window">
                <div class="bot">ì•ˆë…•í•˜ì„¸ìš”! 'í–‡ë‹˜ ë‹¬ë‹˜' ë™í™”ì— ëŒ€í•´ ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”. (ì˜ˆ: ì¸ë¬¼, ë°°ê²½, êµí›ˆ)</div>
            </div>
            <div id="input-area">
                <input type="text" id="userInput" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." onkeypress="if(event.keyCode===13) askChatbot()">
                <button onclick="askChatbot()">ì§ˆë¬¸í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        // 1. ë°ì´í„° ì •ì˜ (Turtle í˜•ì‹) - ë” êµ¬ì²´ì ì¸ ì •ë³´ ì¶”ê°€
        const turtleData = `
            @prefix ex: <http://example.org/folktale/> .
            @prefix schema: <https://schema.org/> .
            
            ex:SunAndMoon
                schema:name "í–‡ë‹˜ ë‹¬ë‹˜" ;
                ex:characters "ì–´ë¨¸ë‹ˆ, ì˜¤ëˆ„ì´(ì˜¤ë¹ ì™€ ì—¬ë™ìƒ), ê·¸ë¦¬ê³  í˜¸ë‘ì´" ;
                ex:setting "ì˜›ë‚  ì˜›ì  ê¹Šì€ ì‚°ì† ì™¸ë”´ì§‘" ;
                ex:lesson "ì–´ë ¤ì›€ ì†ì—ì„œë„ ì§€í˜œë¥¼ ë°œíœ˜í•˜ë©´ í¬ë§ì„ ì°¾ì„ ìˆ˜ ìˆìœ¼ë©°, ê¶Œì„ ì§•ì•…ì˜ êµí›ˆì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤." ;
                ex:plot "ë–¡ì„ íŒ”ëŸ¬ ê°„ ì–´ë¨¸ë‹ˆê°€ í˜¸ë‘ì´ì—ê²Œ ì¡ì•„ë¨¹íˆê³ , í˜¸ë‘ì´ê°€ ì–´ë¨¸ë‹ˆë¡œ ë³€ì¥í•´ ì˜¤ëˆ„ì´ë¥¼ ì°¾ì•„ì˜µë‹ˆë‹¤. ì˜¤ëˆ„ì´ëŠ” ì´ë¥¼ ëˆˆì¹˜ì±„ê³  ë‚˜ë¬´ ìœ„ë¡œ ë„ë§ì³ í•˜ëŠ˜ì— ë„ì›€ì„ ì²­í•©ë‹ˆë‹¤. í•˜ëŠ˜ì—ì„œ ë‚´ë ¤ì˜¨ íŠ¼íŠ¼í•œ ë™ì•„ì¤„ì„ íƒ€ê³  í•˜ëŠ˜ë¡œ ì˜¬ë¼ê°€ ì˜¤ë¹ ëŠ” ë‹¬ì´ ë˜ê³  ì—¬ë™ìƒì€ í–‡ë‹˜ì´ ë©ë‹ˆë‹¤." ;
                ex:skyElements "í•´ì™€ ë‹¬" ;
                ex:escapeMeans "ë‚˜ë¬´ì™€ ë™ì•„ì¤„" .
        `;

        // 2. RDF ìŠ¤í† ì–´ ì„¤ì • ë° ë°ì´í„° íŒŒì‹±
        const store = $rdf.graph();
        const contentType = 'text/turtle';
        const baseUrl = "http://example.org/";
        
        $rdf.parse(turtleData, store, baseUrl, contentType);

        // 3. ì±—ë´‡ ì—”ì§„ í•¨ìˆ˜
        function askChatbot() {
            const input = document.getElementById('userInput').value;
            // ë¹ˆ ì…ë ¥ ë°©ì§€
            if (!input.trim()) return; 

            displayMessage('user', input);
            processQuestion(input);
            document.getElementById('userInput').value = '';
        }

        // ì´ë¯¸ì§€ í´ë¦­ ì‹œ ì±—ë´‡ ì§ˆë¬¸ì„ íŠ¸ë¦¬ê±°í•˜ëŠ” í•¨ìˆ˜
        function askChatbotWithKeyword(keyword) {
            displayMessage('user', keyword + "ì— ëŒ€í•´ ì•Œë ¤ì¤˜");
            processQuestion(keyword);
        }

        // ì‹¤ì œ ì§ˆë¬¸ ì²˜ë¦¬ ë¡œì§
        function processQuestion(query) {
            const subject = $rdf.sym("http://example.org/folktale/SunAndMoon");
            let response = "ì£„ì†¡í•´ìš”, ê·¸ ì •ë³´ëŠ” ì•„ì§ ë°ì´í„°ì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. 'ì¸ë¬¼', 'ë°°ê²½', 'êµí›ˆ', 'ì¤„ê±°ë¦¬', 'í•´ì™€ ë‹¬', 'ë‚˜ë¬´' ë“±ì— ëŒ€í•´ ë¬¼ì–´ë³´ì„¸ìš”!";

            const lowerQuery = query.toLowerCase();

            if (lowerQuery.includes("ì¸ë¬¼") || lowerQuery.includes("ëˆ„ê°€")) {
                const result = store.any(subject, $rdf.sym("http://example.org/folktale/characters"));
                if (result) response = `ë“±ì¥ì¸ë¬¼ì€ ${result.value} ì…ë‹ˆë‹¤.`;
            } else if (lowerQuery.includes("ë°°ê²½") || lowerQuery.includes("ì–´ë””")) {
                const result = store.any(subject, $rdf.sym("http://example.org/folktale/setting"));
                if (result) response = `ë™í™”ì˜ ë°°ê²½ì€ ${result.value} ì…ë‹ˆë‹¤.`;
            } else if (lowerQuery.includes("êµí›ˆ")) {
                const result = store.any(subject, $rdf.sym("http://example.org/folktale/lesson"));
                if (result) response = `ì´ ë™í™”ì˜ êµí›ˆì€ ${result.value} ì…ë‹ˆë‹¤.`;
            } else if (lowerQuery.includes("ì¤„ê±°ë¦¬") || lowerQuery.includes("ì‚¬ê±´") || lowerQuery.includes("ë‚´ìš©")) {
                const result = store.any(subject, $rdf.sym("http://example.org/folktale/plot"));
                if (result) response = `ì£¼ìš” ì¤„ê±°ë¦¬ëŠ” ${result.value} ì…ë‹ˆë‹¤.`;
            } else if (lowerQuery.includes("í•´ì™€ ë‹¬") || lowerQuery.includes("í–‡ë‹˜ ë‹¬ë‹˜")) {
                const result = store.any(subject, $rdf.sym("http://example.org/folktale/skyElements"));
                if (result) response = `ì˜¤ëˆ„ì´ê°€ í•˜ëŠ˜ë¡œ ì˜¬ë¼ê°€ ${result.value}ì´(ê°€) ë˜ì—ˆìŠµë‹ˆë‹¤.`;
            } else if (lowerQuery.includes("ë‚˜ë¬´") || lowerQuery.includes("ì–´ë–»ê²Œ ë„ë§")) {
                const result = store.any(subject, $rdf.sym("http://example.org/folktale/escapeMeans"));
                if (result) response = `ì˜¤ëˆ„ì´ëŠ” ${result.value}ë¥¼ ì´ìš©í•˜ì—¬ ìœ„ê¸°ë¥¼ ëª¨ë©´í–ˆìŠµë‹ˆë‹¤.`;
            }

            displayMessage('bot', response);
        }

        // ë©”ì‹œì§€ë¥¼ ì±„íŒ…ì°½ì— í‘œì‹œí•˜ëŠ” ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        function displayMessage(sender, message) {
            const chatWindow = document.getElementById('chat-window');
            chatWindow.innerHTML += `<div class="${sender}">${sender === 'user' ? 'ë‚˜' : 'ë´‡'}: ${message}</div>`;
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }
    </script>
</body>
</html>
